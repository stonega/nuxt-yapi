import { defineNuxtPlugin } from '#imports'
import { ofetch } from 'ofetch'

export default defineNuxtPlugin((nuxtApp) => {
  const apiProvider = {
    fetch: ofetch.create({
      baseURL: '<%= options.baseUrl %>',
      headers: {
        'Content-Type': 'application/json',
        'accept-language': 'en-US',
      },
      retry: 3,
      retryDelay: 500,
      parseResponse: (data) => {
        const response = JSON.parse(data);
        if (response.code !== '000' && response.code !== 200) {
          throw new Error(response.msg);
        }
        else {
          return response.data;
        }
      },
    }),
  };
  return {
    provide: {
    <% if (options.name) { %>
      <%= options.name %>Api: new <%= options.name %>Yapi(apiProvider)
    <% } else { %>
      api: new Yapi(apiProvider)
    <% } %>
    },
  };
})
